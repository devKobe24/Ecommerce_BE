# π› οΈ 1λ‹¨κ³„: λΉλ“ λ‹¨κ³„ (TLS μ¤λ¥ λ°©μ§€μ© ENV μ¶”κ°€)
FROM gradle:8.5-jdk21 AS build

# β… TLS ν”„λ΅ν† μ½ νΈν™ μ„¤μ • μ¶”κ°€
ENV JAVA_TOOL_OPTIONS="-Djdk.tls.client.protocols=TLSv1.2"

WORKDIR /app

# β… μ „μ²΄ ν”„λ΅μ νΈ λ³µμ‚¬
COPY . .

# β… Gradle λΉλ“ μ‹¤ν–‰ (ν…μ¤νΈ μ μ™Έ)
RUN gradle :gateway-service:clean :gateway-service:bootJar -x test --no-daemon

# π€ 2λ‹¨κ³„: λ°νƒ€μ„ λ‹¨κ³„
FROM eclipse-temurin:21-jre-alpine

WORKDIR /app

# β… λΉλ“ κ²°κ³Όλ¬Ό λ³µμ‚¬
COPY --from=build /app/gateway-service/build/libs/app.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]